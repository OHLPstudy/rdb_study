14장

# 스토어드 프로시저 & 스토어드 프로그램 정리  

## 스토어드 프로시저 (Stored Procedure)  

정의:  
자주 사용하는 SQL 로직을 이름으로 저장하여 재사용할 수 있도록 만든 DB 내부 함수  
SQL을 모듈화하고 함수처럼 호출 가능  

특징:  
CALL 프로시저이름(파라미터); 형태로 호출  
IN / OUT 파라미터 사용 가능  
여러 개의 SQL을 하나로 묶을 수 있음  
비즈니스 로직을 DB에 일부 위임할 수 있음  

사용 이유:  
자주 반복되는 로직 재사용  
클라이언트-DB 간 트래픽 절감  
보안성 및 유지보수성 향상  
트랜잭션 처리 및 캡슐화 가능  

예시 (MySQL):  
```
DELIMITER //
CREATE PROCEDURE GetUserById(IN userId INT)
BEGIN
  SELECT * FROM users WHERE id = userId;
END //
DELIMITER ;

-- 사용
CALL GetUserById(5);
```

## 스토어드 프로그램 (Stored Program)  

정의:  
DB 내부에 저장 가능한 코드 단위 전반을 포괄하는 용어  
스토어드 프로시저를 포함하여, 다음을 모두 포함한 개념  

 <img width="424" alt="image" src="https://github.com/user-attachments/assets/79c3c8aa-782a-48b3-9ff8-976cbbd002af" />

## 스토어드를 언제, 왜, 어떤 실무에서 쓰이는가??  
배치(batch) 작업이나 반복적인 데이터 처리 로직을 DB 내부에서 처리 > 데이터 처리 자동화  
복잡한 트랜잭션 처리(여러 단계의 insert/update 등)를 DB에서 직접 관리 > 트랜잭션 처리  
DB 사용자에게 SELECT는 허용하지만, INSERT/UPDATE는 특정 프로시저를 통해서만 가능하도록 제한 > 권한 관리  
네트워크 왕복 없이 DB 안에서 로직을 처리하여 응답 시간 단축 가능 (단, 요즘은 백엔드에서 처리하는 게 더 일반적) > 성능 최적화  
특정 이벤트 발생 시 자동 실행될 로직(예: INSERT 될 때마다 로그 저장) > 트리거나 이벤트 기반 작업  

<img width="477" alt="image" src="https://github.com/user-attachments/assets/ce1e0c23-6623-4191-b08b-ba3820d1b8ea" />

## 그러면 꼭 사용해야하나??  
결론: “사용은 하지만 신중히”  
ERP/금융/제조 시스템 등 오래된 시스템은 스토어드 프로시저를 많이 사용합니다.  
최근 웹 개발 환경(Node.js, Spring 등)에서는 가능한 한 비즈니스 로직은 애플리케이션 서버에서 처리하고, DB는 CRUD만 맡기는 경우가 많습니다.  
단, 특정 트랜잭션을 묶어야 할 때, 권한 제한이 필요한 상황, 데이터 정제/마이그레이션 작업 등에는 여전히 유용합니다.  

--- 
## 트리거    
MySQL에서 트리거(Trigger)는 테이블에서 INSERT, UPDATE, DELETE 이벤트가 발생할 때 자동으로 실행되는 SQL 블록  

### 사용 목적  
특정 테이블 변경 시 자동으로 다른 작업 수행 > 자동화  
잘못된 변경을 막고 보정 > 데이터 무결성 유지  
변경 이력 자동 기록 > 감사 로그   
한 테이블 변경 시 다른 테이블도 자동 갱신 > 테이블 동기화  


### 사용 시 주의사항  
트리거 내부에서 트리거 대상 테이블을 수정할 수 없음 (무한 루프 방지)  
복잡한 트리거는 성능 저하 및 디버깅 어려움 유발  
비즈니스 로직은 애플리케이션에서 처리, 하지만 무결성·감사 기록은 트리거 사용 적합  






